let e=null,t=null,o=null;try{e=localStorage.getItem("fv_recorder_tab")}catch(e){}if(e){e=parseInt(e),setTimeout((()=>{localStorage.removeItem("fv_recorder_tab")}),5e3),t=new BroadcastChannel(`channel-${e}`),t.addEventListener("message",(t=>{if(t.origin===location.origin&&(chrome.runtime.sendMessage({cmd:"REC_ON_DATA",parameter:{recorderTab:e,data:t.data}}),null===o))try{const e=window.top.document;o=e.createElement("div"),o.style.width="100%",o.style.height="100%",o.style.position="fixed",o.style.bottom=0,o.style.right=0,o.style.zIndex=99999999,o.style.pointerEvents="none";const t=new Image;t.width=150,t.height=150,t.src=chrome.runtime.getURL("img/recording.svg"),t.style.position="absolute",t.style.right="10px",t.style.bottom="10px",o.appendChild(t),e.body.appendChild(o)}catch(e){o=!1}}));const r=document.createElement("script");r.src=chrome.runtime.getURL("js/hook.js"),document.documentElement.appendChild(r),window.addEventListener("beforeunload",(o=>{try{self===top&&(chrome.runtime.sendMessage({cmd:"REC_STOP",parameter:{tabId:e}}),localStorage.removeItem("fv_recorder_tab")),t&&t.close()}catch(e){}}))}function r(e,t){let o=!1;const n=e.URL,c=e.querySelectorAll("video");if(c.length>0)for(const e of c){let o=e.src;if(!o){const t=e.querySelector("source");t&&(o=t.src)}if(o&&(/^(http:\/\/|https:\/\/)/i.test(o)||(o=new URL(o,n)),o===t))return!0}const s=e.getElementsByTagName("iframe");for(let e=0;e<s.length;e++)try{o=r(s[e].contentDocument||s[e].contentWindow.document)||o}catch(e){continue}return o}chrome.runtime.onMessage.addListener((function(e,n,c){const{cmd:s,parameter:a}=e;if("REC_START"===s)return localStorage.setItem("fv_recorder_tab",a.tab),document.querySelectorAll('video[src^="blob:"]').forEach((e=>{e.currentTime=0})),setTimeout((()=>{self===top&&(c(),window.location.reload())}),500),!0;if("REC_STOP"===s)return t&&t.postMessage({cmd:s}),o&&o.remove(),c(),!0;if("REC_SPEED_UP"===s){const{speed:e}=a;return document.querySelectorAll('video[src^="blob:"]').forEach((t=>{isNaN(t.duration)||(t.playbackRate=e)})),c(),!0}if("CHECK_VIDEO"===s){const{url:e}=a;return c(r(document,e)),!0}}));