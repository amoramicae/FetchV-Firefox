(()=>{let e=!1,t=localStorage.getItem("fv_recorder_tab");if(!t)return;t=parseInt(t);const n=new BroadcastChannel(`channel-${t}`);function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}n.addEventListener("message",(t=>{"REC_STOP"===t.data.cmd&&(e=!0)}));const o=window.MediaSource;window.MediaSource=new Proxy(o,{construct(t,o){const a=r(1e3,2e8),c=new t(...o);let u=!1;return c.addEventListener("sourceended",(()=>{e||setTimeout((()=>{n.postMessage({url:null,mid:a,live:u})}),5e3)})),c.addSourceBuffer=new Proxy(c.addSourceBuffer,{apply(t,o,i){const l=r(1e3,2e8),s=i[0],d=t.apply(o,i);return d.appendBuffer=new Proxy(d.appendBuffer,{apply(t,r,o){if(!e&&o.length>0){const e=o[0];if(e.length>0||e.byteLength>0){const t=new Blob([e]),r=URL.createObjectURL(t);u=c.duration===1/0,n.postMessage({url:r,mime:s,mid:a,bid:l,live:u}),setTimeout((function(){URL.revokeObjectURL(r)}),1e4)}}return t.apply(r,o)}}),d}}),c}});const a=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime");let c,u=!1,i=!1;setTimeout((()=>{i=!0}),1e4),Object.defineProperty(HTMLMediaElement.prototype,"currentTime",{get:function(){return a.get.call(this)},set:function(e){return i||(u?null!==c&&(e=0):(e=0,u=!0,c=setTimeout((()=>{c=null}),1e3))),a.set.call(this,e)}})})();